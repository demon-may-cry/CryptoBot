
## Как запустить

При открытии директории через IntelliJ IDEA проект должен автоматически распознаться.
У вас должна появится `run configuration CryptoBotApplication` (зеленый треугольник),
если не появился, можно пройти в класс `CryptoBotApplication` и оттуда напрямую вызвать `main` метод.

В `application.yaml` не вписывайте данные `BOT_NAME` и `BOT_TOKEN`, так как можете отправить их в публичный репозиторий.
Используйте переменные среды для установки значений. Для установки переменных среды в вашей системе или в среде запуска выполните команды:
- В Linux/macOS:
```bash

export BOT_NAME=CryptoBot...
export BOT_TOKEN=8593175646:AAHXq-...
```
- В Windows (PowerShell):
```powershell
$env:BOT_NAME = "CryptoBot..."
$env:BOT_TOKEN = "8593175646:AAHXq-..."
```
## О проекте

### Механизм отслеживания стоимости
Каждые две минуты запрашивается актуальная стоимость биткоина в USD.
Ищем пользователей с подписками, у которых желаемая стоимость выше текущей.
Отправляем найденным пользователям сообщение: «Пора покупать, стоимость биткоина ХХХ».
Сообщение «Пора покупать, стоимость биткоина ХХХ» приходит не чаще одного раза в десять минут.

### База данных
Для проекта выбрана база данных PostgreSQL.
Для удобной работы с PostgreSQL используется docker-образ,
вам не нужно самостоятельно устанавливать PostgreSQL.
Выполнив `docker compose up`, вы запустите PostgreSQL с предустановленными
настройками (их посмотреть можно в файле `docker-compose.yaml`).
Для запуска докер образа вам понадобится установить `docker` и `docker-compose` 

### Spring проект

В данном проекте используется Spring, gradle используется в качестве системы сборки.
Основные зависимости уже указаны.

В `application.yml` находятся конфигурируемые параметры нашего приложения
(в частности, там указывается токен вашего бота)

### Основные функции приложения:

- подписка на конкретную стоимость биткоина,
- вывод информации о текущей подписке,
- возможность включить или отключить подписку.

### Создание бота
Для создания бота вы можете ознакомиться с [инструкцией](https://core.telegram.org/bots/tutorial#obtain-your-bot-token) и получить токен для использования созданного.
Для работы с Telegram Bot API используется готовая [библиотека](https://github.com/rubenlagus/TelegramBots). Для получения цены биткоина приложение использует [запрос](https://api.binance.com/api/v3/avgPrice?symbol=BTCUSDT) к API криптобиржи Binance.

### Активация бота
Обработка команды: `/start`

Когда пользователь заходит в бота и нажимает `/start` первый раз, в базе данных появляется новая запись о пользователе.

В таблице _Subscribers_ храниться:

- _UUID_ - пользователя;
- _ID_ - пользователя в Telegram;
- _PRICE_ - цена, на которую подписан пользователь, если её нет — _NULL_.

Для нового пользователя цена, на которую он подписан, равна _NULL_.

### Получение стоимости биткоина
Обработка команды `/get_price`

Приложение выводит текущую стоимость валюты.

### Создание новой подписки
Обработка команды: `/subscribe`

Когда пользователь присылает команду `/subscribe 34600`, сервис добавляет в базу данных значение о желаемой стоимости биткоина для конкретного пользователя и возвращает текущее значение курса биткоина.

В базе данных в поле _PRICE_ записывается значение, переданное пользователем.

Если пользователь уже подписан, то перезаписывается новое значение желаемой цены.

### Вывод информации об имеющейся подписке
Обработка команды: `/get_subscription`

Приложение выводит сведения об имеющейся подписке. Если нет активных подписок, выводится сообщение об отсутствии подписок.


### Удаление активной подписки
Обработка команды: `/unsubscribe`

Команда удаляет текущую подписку пользователя, если её не было, то выводится сообщение об отсутствии подписок.